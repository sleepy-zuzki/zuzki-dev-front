<main class="blog-admin">
  <header class="blog-admin__header">
    <app-typography-title [level]="1" variant="page">
      Gestión de Blog
    </app-typography-title>
    <app-typography-text variant="muted">
      Crea, edita y gestiona tus artículos y tutoriales.
    </app-typography-text>
  </header>

  <section class="blog-admin__create-section" aria-label="Crear o editar artículo">
    <app-typography-title [level]="2" variant="section" class="blog-admin__section-title">
      {{ selectedEntryId() ? 'Editar artículo' : 'Crear nuevo artículo' }}
    </app-typography-title>

    <div class="blog-admin__form-wrapper">
      <form [formGroup]="form" (ngSubmit)="onCreate()" novalidate>
        <app-blog-form 
          [form]="form" 
          (coverImageSelected)="onUploadCover($event)"
          (galleryImageSelected)="onSelectFromGallery($event)"
        ></app-blog-form>

        <div class="blog-admin__submit-wrapper gap-2">
          @if (selectedEntryId()) {
            <app-button
              variant="outline"
              type="button"
              (click)="onCancel()"
              [disabled]="loading() || uploading()"
            >
              Cancelar
            </app-button>
          }
          <app-button
            type="submit"
            [disabled]="form.invalid || loading() || uploading()"
            class="blog-admin__submit-button"
          >
            @if (uploading()) {
              Subiendo imagen...
            } @else {
              {{ selectedEntryId() ? 'Guardar Cambios' : 'Crear Borrador' }}
            }
          </app-button>
        </div>
      </form>
    </div>
  </section>

  <section class="blog-admin__list-section" aria-label="Listado de artículos">
    @if (loading() && entries().length === 0) {
      <app-typography-text variant="muted">Cargando artículos...</app-typography-text>
    } @else if (error()) {
      <div class="blog-admin__alert">
        <span class="blog-admin__alert-text">{{ error() }}</span>
        <button type="button" (click)="reload()" class="blog-admin__reload-button">Reintentar</button>
      </div>
    } @else if (entries().length === 0) {
      <app-typography-text>No hay artículos creados aún.</app-typography-text>
    } @else {
      <div class="blog-admin__list">
        @for (entry of entries(); track entry.id) {
          <article class="blog-admin__item">
            <div class="blog-admin__item-content">
              <div class="flex items-center gap-2 mb-1">
                <span class="px-2 py-0.5 text-xs font-medium rounded-full"
                      [class.bg-yellow-100]="entry.status === BlogStatus.DRAFT"
                      [class.text-yellow-800]="entry.status === BlogStatus.DRAFT"
                      [class.bg-green-100]="entry.status === BlogStatus.PUBLISHED"
                      [class.text-green-800]="entry.status === BlogStatus.PUBLISHED"
                      [class.bg-gray-100]="entry.status === BlogStatus.ARCHIVED"
                      [class.text-gray-800]="entry.status === BlogStatus.ARCHIVED">
                  {{ entry.status | uppercase }}
                </span>
                <h3 class="blog-admin__item-title m-0">{{ entry.title }}</h3>
              </div>
              <p class="blog-admin__item-meta">
                @if (entry.publishDate) {
                  Publicado: {{ entry.publishDate | date:'mediumDate' }}
                } @else {
                  Creado: {{ entry.createdAt | date:'mediumDate' }}
                }
              </p>
              <p class="blog-admin__item-desc">{{ entry.description }}</p>
            </div>
            <div class="blog-admin__item-actions flex gap-2">
              <button
                type="button"
                (click)="onEdit(entry)"
                class="text-sm font-medium text-blue-600 hover:text-blue-800"
              >
                Editar
              </button>
              @if (entry.status === BlogStatus.DRAFT) {
                <button
                  type="button"
                  (click)="onPublish(entry.id)"
                  class="text-sm font-medium text-brand-primary hover:text-brand-hover"
                >
                  Publicar
                </button>
              }
              <button
                type="button"
                (click)="onDelete(entry.id)"
                class="blog-admin__delete-button"
                aria-label="Eliminar artículo"
              >
                Eliminar
              </button>
            </div>
          </article>
        }
      </div>
    }
  </section>
</main>
