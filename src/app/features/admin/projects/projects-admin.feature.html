<main id="projects-admin" aria-label="Gestión de Proyectos" class="min-h-[60vh] p-6">
  <header class="mb-6">
    <app-typography-title [level]="1" variant="page">
      Gestión de Proyectos
    </app-typography-title>
    <app-typography-text variant="muted">
      Aquí podrás crear y editar la información de los proyectos.
    </app-typography-text>
  </header>

  <section aria-label="Crear nuevo proyecto" class="mb-10">
    <app-typography-title [level]="2" variant="section">Crear nuevo proyecto</app-typography-title>

    <form [formGroup]="form" (ngSubmit)="onCreate()" class="mt-4 grid gap-4 md:grid-cols-2" novalidate>
      <div class="md:col-span-1">
        <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Nombre</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="Mi proyecto"
          aria-describedby="name-error"
        />
        @if (f.name.invalid && (f.name.dirty || f.name.touched)) {
          <p id="name-error" class="mt-1 text-xs text-red-600 dark:text-red-400">Nombre requerido (2-150 caracteres)</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="slug" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Slug</label>
        <input
          id="slug"
          type="text"
          formControlName="slug"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="mi-proyecto"
          aria-describedby="slug-error"
        />
        @if (f.slug.invalid && (f.slug.dirty || f.slug.touched)) {
          <p id="slug-error" class="mt-1 text-xs text-red-600 dark:text-red-400">Slug requerido (kebab-case, 2-160)</p>
        }
      </div>

      <div class="md:col-span-2">
        <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Descripción (opcional)</label>
        <textarea
          id="description"
          rows="3"
          formControlName="description"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="Resumen del proyecto (máx. 1000)"
          aria-describedby="description-error"
        ></textarea>
        @if (f.description.invalid && (f.description.dirty || f.description.touched)) {
          <p id="description-error" class="mt-1 text-xs text-red-600 dark:text-red-400">Máximo 1000 caracteres</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="liveUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Live URL (opcional)</label>
        <input
          id="liveUrl"
          type="url"
          formControlName="liveUrl"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="https://demo.ejemplo.com"
          aria-describedby="liveUrl-error"
        />
        @if (f.liveUrl.invalid && (f.liveUrl.dirty || f.liveUrl.touched)) {
          <p id="liveUrl-error" class="mt-1 text-xs text-red-600 dark:text-red-400">URL inválida (http/https)</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="repoUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Repo URL (opcional)</label>
        <input
          id="repoUrl"
          type="url"
          formControlName="repoUrl"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="https://github.com/usuario/repo"
          aria-describedby="repoUrl-error"
        />
        @if (f.repoUrl.invalid && (f.repoUrl.dirty || f.repoUrl.touched)) {
          <p id="repoUrl-error" class="mt-1 text-xs text-red-600 dark:text-red-400">URL inválida (http/https)</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="category" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Categoría (opcional)</label>
        <input
          id="category"
          type="text"
          formControlName="category"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="web, mobile, etc."
        />
      </div>

      <div class="md:col-span-1">
        <label for="year" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Año (opcional)</label>
        <input
          id="year"
          type="number"
          min="1900"
          max="2100"
          formControlName="year"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="2024"
          aria-describedby="year-error"
        />
        @if (f.year.invalid && (f.year.dirty || f.year.touched)) {
          <p id="year-error" class="mt-1 text-xs text-red-600 dark:text-red-400">Entre 1900 y 2100</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="isFeatured" class="inline-flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-200">
          <input id="isFeatured" type="checkbox" formControlName="isFeatured" class="rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400" />
          Destacado
        </label>
      </div>

      <div class="md:col-span-1">
        <label for="previewImageId" class="block text-sm font-medium text-gray-700 dark:text-gray-200">ID imagen previa (opcional)</label>
        <input
          id="previewImageId"
          type="number"
          min="1"
          formControlName="previewImageId"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="Ej: 12"
          aria-describedby="previewImageId-error"
        />
        @if (f.previewImageId.invalid && (f.previewImageId.dirty || f.previewImageId.touched)) {
          <p id="previewImageId-error" class="mt-1 text-xs text-red-600 dark:text-red-400">Debe ser un entero >= 1</p>
        }
      </div>

      <div class="md:col-span-1">
        <label for="technologyIds" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Tecnologías (IDs)</label>
        <input
          id="technologyIds"
          type="text"
          formControlName="technologyIds"
          class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-gray-900 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
          placeholder="1, 2, 3"
        />
        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">IDs separados por coma (opcional)</p>
      </div>

      <div class="md:col-span-2">
        <button
          type="submit"
          [disabled]="form.invalid || loading()"
          class="inline-flex items-center rounded-md bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-4 py-2 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 dark:focus-visible:ring-blue-400 transition"
          aria-label="Crear proyecto"
        >
          Crear proyecto
        </button>
      </div>
    </form>
  </section>

  <section aria-label="Listado de proyectos" class="space-y-4">
    @if (loading()) {
      <app-typography-text variant="muted">Cargando proyectos…</app-typography-text>
    } @else if (error()) {
      <div role="alert" class="rounded-md border border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/30 p-4">
        <app-typography-text class="block text-red-800 dark:text-red-300">{{ error() }}</app-typography-text>
        <button
          type="button"
          (click)="reload()"
          class="mt-2 inline-flex items-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-1.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 dark:focus-visible:ring-blue-400 transition"
          aria-label="Reintentar cargar proyectos"
        >
          Reintentar
        </button>
      </div>
    } @else if (projects().length === 0) {
      <app-typography-text>No hay proyectos aún.</app-typography-text>
    } @else {
      <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-800">
        @for (p of projects(); track p.id) {
          <li class="py-4 flex items-start justify-between">
            <div class="min-w-0 pr-4">
              <app-typography-title [level]="3" variant="subsection">{{ p.name }}</app-typography-title>
              <app-typography-text variant="muted">{{ p.description }}</app-typography-text>
            </div>
            <div class="shrink-0 flex items-center gap-2">
              @if (p.isFeatured) {
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200">
                  Destacado
                </span>
              }
              @if (p.category) {
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200">
                  {{ p.category }}
                </span>
              }
            </div>
          </li>
        }
      </ul>
    }
  </section>
</main>
